<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>GCO PKM Assistant</title><script type="module" src="/_astro/Layout.astro_astro_type_script_index_0_lang.DsVmz98w.js"></script><link rel="stylesheet" href="/_astro/index.DnBimV0v.css"></head> <body class="bg-gray-100">  <div id="login-screen" class="flex items-center justify-center min-h-screen bg-gradient-to-br from-indigo-500 to-purple-600"> <div class="bg-white p-8 rounded-xl shadow-2xl w-full max-w-md mx-4"> <h1 class="text-3xl font-bold mb-2 text-gray-800">GCO PKM Assistant</h1> <p class="text-gray-600 mb-6">Enter your password to continue</p> <form id="login-form" class="space-y-4"> <input type="password" id="password-input" placeholder="Password" autocomplete="current-password" autofocus required class="w-full px-4 py-3 border border-gray-300 rounded-lg text-base focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-shadow"> <button type="submit" id="login-btn" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-medium py-3 rounded-lg transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed">
Login
</button> <div id="login-error" class="text-red-600 text-sm hidden"></div> </form> </div> </div> <div id="app" class="hidden flex flex-col h-screen"> <!-- Header --> <div class="bg-blue-500 text-white px-4 py-4 shadow-md"> <h1 class="text-xl font-semibold">GCO PKM Assistant</h1> </div> <!-- Chat Area --> <div id="chat" class="flex-1 overflow-y-auto p-4 space-y-4"> <!-- Empty State --> <div class="empty-state text-center py-12" id="empty-state"> <h2 class="text-2xl font-semibold text-gray-800 mb-2">Welcome to your PKM Assistant</h2> <p class="text-gray-600 mb-8">Ask me anything about your notes</p> <div class="max-w-md mx-auto space-y-2"> <button class="example-query w-full text-left px-4 py-3 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors" onclick="sendExample('What did I write about music this summer?')">
What did I write about music this summer?
</button> <button class="example-query w-full text-left px-4 py-3 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors" onclick="sendExample('Show me all my active TODOs')">
Show me all my active TODOs
</button> <button class="example-query w-full text-left px-4 py-3 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors" onclick="sendExample('When was the last time I mentioned sailing?')">
When was the last time I mentioned sailing?
</button> <button class="example-query w-full text-left px-4 py-3 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors" onclick="sendExample('List all my org files')">
List all my org files
</button> </div> </div> <!-- Loading Indicator --> <div id="loading" class="hidden items-center gap-2 px-6 py-3 bg-white border border-gray-200 rounded-xl max-w-[80%]"> <div class="w-4 h-4 border-2 border-gray-300 border-t-blue-500 rounded-full animate-spin"></div> <span class="text-gray-600">Thinking...</span> </div> </div> <!-- Controls --> <div class="flex flex-wrap gap-2 px-4 py-2 bg-white border-t border-gray-200 text-sm"> <button onclick="clearConversation()" class="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 border border-gray-300 rounded-lg transition-colors">
Clear Conversation
</button> <button onclick="newSession()" class="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 border border-gray-300 rounded-lg transition-colors">
New Session
</button> <button onclick="logout()" class="ml-auto px-4 py-2 bg-white hover:bg-red-50 text-red-600 border border-red-600 rounded-lg transition-colors">
Logout
</button> </div> <!-- Input Area --> <div class="flex gap-2 p-4 bg-white border-t border-gray-200 shadow-lg"> <input id="input" type="text" placeholder="Ask about your notes..." autocomplete="off" class="flex-1 px-4 py-3 border border-gray-300 rounded-lg text-base focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-shadow"> <button id="send-btn" onclick="send()" class="px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white font-medium rounded-lg transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed">
Send
</button> </div> </div>   </body></html> <script type="module">const I=window.markdownit({html:!1,linkify:!0,typographer:!0});let o=localStorage.getItem("pkm-authToken"),i=localStorage.getItem("pkm-sessionId")||"session-"+Date.now()+"-"+Math.random().toString(36).substr(2,9);localStorage.setItem("pkm-sessionId",i);const w=document.getElementById("login-screen"),k=document.getElementById("app"),d=document.getElementById("password-input"),p=document.getElementById("login-btn"),l=document.getElementById("login-error"),r=document.getElementById("chat"),n=document.getElementById("input"),v=document.getElementById("send-btn"),a=document.getElementById("loading"),u=document.getElementById("empty-state");async function S(e){e.preventDefault();const t=d.value;p.disabled=!0,l.classList.add("hidden");try{const s=await fetch("/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:t})}),h=await s.json();s.ok?(o=h.token,localStorage.setItem("pkm-authToken",o),E()):(l.textContent=h.error||"Invalid password",l.classList.remove("hidden"),d.value="",d.focus())}catch(s){l.textContent="Connection error: "+s.message,l.classList.remove("hidden")}finally{p.disabled=!1}}function E(){w.classList.add("hidden"),k.classList.remove("hidden"),n.focus(),x()}function c(){w.classList.remove("hidden"),k.classList.add("hidden"),d.value="",d.focus()}function L(){o=null,localStorage.removeItem("pkm-authToken"),c()}async function T(){if(!o){c();return}try{(await(await fetch("/verify-token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:o})})).json()).valid?E():(o=null,localStorage.removeItem("pkm-authToken"),c())}catch(e){console.error("Token verification error:",e),c()}}function f(){const e={"Content-Type":"application/json"};return o&&(e.Authorization=`Bearer ${o}`),e}function g(){o=null,localStorage.removeItem("pkm-authToken"),c(),alert("Your session has expired. Please log in again.")}async function y(){const e=n.value.trim();if(e){n.value="",n.disabled=!0,v.disabled=!0,u.style.display="none",m("user",e),a.classList.remove("hidden"),a.classList.add("flex"),r.scrollTop=r.scrollHeight;try{const t=await fetch("/query",{method:"POST",headers:f(),body:JSON.stringify({message:e,session_id:i})});if(t.status===401){g();return}const s=await t.json();a.classList.add("hidden"),a.classList.remove("flex"),m("assistant",s.response)}catch(t){a.classList.add("hidden"),a.classList.remove("flex"),m("assistant","❌ Error: "+t.message)}finally{n.disabled=!1,v.disabled=!1,n.focus()}}}function b(e){n.value=e,y()}function m(e,t){const s=document.createElement("div");s.className=`message ${e}`,e==="assistant"?s.innerHTML=I.render(t):s.textContent=t,r.insertBefore(s,a),r.scrollTop=r.scrollHeight}async function B(){if(confirm("Clear conversation history?"))try{if((await fetch(`/sessions/${i}`,{method:"DELETE",headers:f()})).status===401){g();return}r.querySelectorAll(".message").forEach(s=>s.remove()),u.style.display="block",console.log("Conversation cleared")}catch(e){alert("Error clearing conversation: "+e.message)}}function C(){i="session-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),localStorage.setItem("pkm-sessionId",i),r.querySelectorAll(".message").forEach(t=>t.remove()),u.style.display="block",console.log("New session started:",i)}async function x(){try{const e=await fetch(`/sessions/${i}/history`,{headers:f()});if(e.status===401){g();return}const t=await e.json();t.length>0&&(u.style.display="none",t.forEach(s=>m(s.role,s.text)))}catch(e){console.error("Error loading history:",e)}}n.addEventListener("keypress",e=>{e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),y())});document.addEventListener("keydown",e=>{(e.metaKey||e.ctrlKey)&&e.key==="k"&&(e.preventDefault(),n.focus())});document.getElementById("login-form")?.addEventListener("submit",S);T();window.send=y;window.sendExample=b;window.clearConversation=B;window.newSession=C;window.logout=L;</script>